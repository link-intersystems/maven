package com.link_intersystems.maven.plugin.system;

import org.codehaus.plexus.PlexusContainer;
import org.codehaus.plexus.classworlds.realm.ClassRealm;
import org.codehaus.plexus.component.annotations.Component;
import org.codehaus.plexus.component.annotations.Requirement;
import org.codehaus.plexus.component.configurator.AbstractComponentConfigurator;
import org.codehaus.plexus.component.configurator.ComponentConfigurationException;
import org.codehaus.plexus.component.configurator.ComponentConfigurator;
import org.codehaus.plexus.component.configurator.ConfigurationListener;
import org.codehaus.plexus.component.configurator.converters.special.ClassRealmConverter;
import org.codehaus.plexus.component.configurator.expression.ExpressionEvaluator;
import org.codehaus.plexus.configuration.PlexusConfiguration;

@Component(role = ComponentConfigurator.class, hint = "editorSupport")
public class PropertyEditorSupportConfigurator extends
		AbstractComponentConfigurator {

	@Requirement
	private PlexusContainer container;

	@Override
	public void configureComponent(final Object component,
			final PlexusConfiguration configuration,
			final ExpressionEvaluator expressionEvaluator,
			final ClassRealm containerRealm,
			final ConfigurationListener listener)
			throws ComponentConfigurationException {
		converterLookup.registerConverter(new ClassRealmConverter(
				containerRealm));
		PropertyEditorLookup propertyEditorLookup = new PropertyEditorLookup(container);
		PropertyEditorSupportConverter converter = new PropertyEditorSupportConverter(propertyEditorLookup);

		converter.processConfiguration(converterLookup, component,
				containerRealm, configuration, expressionEvaluator, listener);
	}

}
